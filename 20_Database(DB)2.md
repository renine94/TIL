# 데이터베이스(2) DB

### 트랜잭션 (transaction) 의 개념

- 하나의 작업을 수행하기 위해 필요한 데이터베이스 연산들을 모아놓은 것
- 작업 수행에 필요한 SQL 문들의 모임
- 논리적인 `작업의 단위`
- 장애 발생 시 복구 작업이나 병행 제어 작업을 위한 중요한 단위로 사용됨
- 데이터베이스의 무결성과 일관성을 보장하기 위해 작업 수행에 필요한 연산들을 하나의
  트랜잭션으로 제대로 정의하고 관리해야 함

> 현금인출을 할때,
>
> 돈을 조회하는 쿼리문 => 값을 수정하는 쿼리문 => 등등.. 하나의 거래 단위



### 트랜잭션의 특성

- **원자성**
  - 트랜잭션의 연산들이 모두 정상적으로 실행되거나 하나도 실행되지 않아야 하는 All-or-nothing 방식
- **일관성**
  - 트랜잭션이 성공적으로 수행된 후에도 데이터베이스가 일관성 있는 상태를 유지해야 함
- **격리성**
  - 수행 중인 트랜잭션이 완료될 때까지 다른 트랜잭션들이 중간 연산 결과에 접근할 수 없음을 의미
- **지속성**
  - 트랜잭션이 성공적으로 완료된 후 데이터베이스에 반영한 수행 결과는 영구적이어야 함
  - 지속성의 보장을 위해서는 장애 발생 시 회복 기능이 필요

![image-20200322194922194](img/image-20200322194922194.png)



### 트랜잭션의 주요연산

- `commit` 연산
  - 트랜잭션의 수행이 성공적으로 완료되었음을 선언하는 연산
  - commit 연산이 실행되면 트랜잭션의 수행 결과가 데이터베이스에 반영되고 일관된 상태를 
    지속적으로 유지하게 된다.
- `rollback` 연산
  - 트랜잭션의 수행이 실패했음을 선언하는 연산
  - rollback 연산이 실행되면 지금까지 트랜잭션이 실행한 연산의 결과가 취소되고 데이터베이스가
    트랜잭션 수행 전의 일관된 상태로 되돌아감





### 장애

- 장애
  - 시스템이 제대로 동작하지 않는 상태
- 트랜잭션 장애
  - 트랜잭션 중 오류가 발생하여 정상적으로 수행을 계속할 수 없는 상태
- 시스템 장애
  - 하드웨어의 결함으로 정상적으로 수행을 계속할 수 없는 상태
- 미디어 장애
  - 디스크 장치의 결함으로 디스크에 저장된 데이터베이스의 일부 혹은 전체가 손상된 상태



### 회복

- 회복 (recovery)
  - 장애가 발생했을 때 데이터베이스를 장애가 발생하기 전의 일관된 상태로 복구시키는 것
  - 트랜잭션의 특성을 보장하고, 데이터베이스를 일관된 상태로 유지하기 위해 필수적인 기능
  - 회복 관리자(recovery manager) 가 담당
  - 장애 발생을 탐지하고, 장애가 탐지되면 데이터베이스를 복구하는 기능을 제공



### 회복 기법

- 로그 회복 기법
  - 즉시 갱신
    - 트랜잭션 수행중에 데이터 변경 연산의 결과를 데이터베이스에 즉시 반영
- 로그 회복 기법
  - 지연 갱신
    - 트랜잭션 수행중에 데이터 변경 연산의 결과를 로그에만 기록해두고, 트랙잭션이 완료된 후에
      로그에 기록된 내용을 이용해 데이터베이스에 한번에 반영
- 검사 시점 회복 기법
  - 로그 기록을 이용하되, 일정 시간 간격으로 검사 시점 (checkpoint) 를 만듬
  - 장애 발생 시 가장 최근 검사 시점 이후의 트랜잭션에만 회복 작업 수행
- 미디어 회복 기법
  - 디스크에 발생 할 수 있는 장애에 대비한 회복 기법



### 병행 수행과 병행 제어

- 병행 수행
  - 여러 사용자가 데이터베이스를 동시 공유할 수 있도록 여러 개의 트랜잭션을 동시에 수행하는 것
  - 여러 트랜잭션들이 차례로 번갈아 수행되는 인터리빙 방식으로 진행됨
- 병행 제어 또는 동시성 제어
  - 병행 수행 시 같은 데이터에 접근하여 연산을 실행해도 문제가 발생하지 않고
    정확한 수행 결과를 얻을 수 있도록 트랜잭션의 수행을 제어하는 것을 의미





### 보안과 권한 관리

- 권한 관리 / 역할관리
- 권한 관리를 통한 보안
  - 객체 권한 부여 : Grant 문
  - 객체 권한 취소 : Revoke 문
  - 역할 생성 : Create role 문
  - 역할에 권한 추가 : Grant 문
  - 역할 취소 : Revoke 문
  - 역할 제거 : Drop role 문



### 분산 데이터베이스 시스템

- 중앙 집중적 데이터베이스 시스템
  - 데이터베이스 시스템을 물리적으로 한 장소에 설치하여 운영하는 것
- 분산 데이터베이스 시스템 (distributed database system)
  - 물리적으로 분산된 DB 시스템을 네트워크로 연결해 사용자가 논리적으로는
    하나의 중앙 집중식 데이터베이스 시스템 처럼 사용할 수 있도록 한 것





